{% extends "base.html" %}
{% block content %}
<section class="settings-section">
  <h2>Two-Factor Authentication (2FA)</h2>
  <p>You can secure your account with one or both of the following:</p>

  <div class="twofa-options">
    <!-- üîπ Authenticator App (TOTP) -->
    <div class="twofa-option">
      <h3>Authenticator App (TOTP)</h3>
      {% if current_user.TOTP_SECRET %}
        <p><strong>Status:</strong> Enabled ‚úÖ</p>
        <form method="post" action="{{ url_for('auth.disable_totp') }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button class="btn btn-outline-danger" type="submit">Disable TOTP</button>
        </form>
      {% else %}
        <p>Protect your account using an authenticator app like Google Authenticator or DUO.</p>
        <a class="btn btn-primary" href="{{ url_for('auth.twofa_setup') }}">Set up Authenticator App</a>
      {% endif %}
    </div> <br>

    <!-- üîπ Email Verification -->
    <div class="twofa-option">
      <h3>Email Verification</h3>
      {% if current_user.EMAIL_2FA_ENABLED %}
        <p><strong>Status:</strong> Enabled ‚úÖ</p>
        <form method="post" action="{{ url_for('auth.email_2fa_disable') }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button class="btn btn-outline-danger" type="submit">Disable Email 2FA</button>
        </form>
      {% else %}
        <p>Enable email-based verification to receive login codes via your email.</p>
        <form method="post" action="{{ url_for('auth.email_2fa_enable') }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button class="btn btn-primary" type="submit">Enable Email 2FA</button>
        </form>
      {% endif %}
    </div>
  </div>
</section>

<p style="margin-top: 1.5rem; text-align: center;">
  {% if current_user.USER_TYPE == 'admin' %}
    <a class="btn btn-outline" href="{{ url_for('administrator_bp.dashboard') }}">‚Üê Back to Admin Dashboard</a>
  {% elif current_user.USER_TYPE == 'sponsor' %}
    <a class="btn btn-outline" href="{{ url_for('sponsor_bp.dashboard') }}">‚Üê Back to Sponsor Dashboard</a>
  {% elif current_user.USER_TYPE == 'driver' %}
    <a class="btn btn-outline" href="{{ url_for('driver_bp.dashboard') }}">‚Üê Back to Driver Dashboard</a>
  {% else %}
    <a class="btn btn-outline" href="{{ url_for('common.index') }}">‚Üê Back to Home</a>
  {% endif %}
</p>
{% endblock %}
