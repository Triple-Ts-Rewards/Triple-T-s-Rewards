{% extends "base.html" %}
{% block content %}
<section class="centered-content reset-page">
  <div class="apply-form">
    <h2>Reset Password</h2>

    <form method="POST">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <div class="form-group">
        <label for="username">Username</label>
        <input id="username" name="username" required>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Reset Password</button>
      </div>
    </form>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% for category, message in messages %}
        <div class="flash-messages {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endwith %}
  </div>
  <script>
document.querySelector("form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const csrfToken = document.querySelector('input[name="csrf_token"]').value;

  const response = await fetch("{{ url_for('auth.reset_password') }}", {
    method: "POST",
    headers: { "X-CSRFToken": csrfToken },
    body: formData,
  });

  if (response.ok) {
    const data = await response.json();
    if (data.reset_url) {
      window.open(data.reset_url, "_blank"); // open link in new tab
    }
  } else {
    alert("Error creating reset link. Please try again.");
  }
});
</script>
</section>
{% endblock %}