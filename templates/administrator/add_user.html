{% extends "base.html" %}
{% block content %}
    <h2>Add New User</h2>
    <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required>
        <br><br>
        <label for="name">Name:</label>
        <input
          type="text"
          id="name"
          name="name"
          pattern="^[A-Za-z]+\s[A-Za-z]+$"
          title="Please enter only a first and last name (letters only, separated by a space)."
          required
        >
        <br><br>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <br><br>
        <label for="role">Role:</label>
        <select id="role" name="role" required>
            <option value="driver">Driver</option>
            <option value="sponsor">Sponsor</option>
            <option value="administrator">Admin</option>
        </select>
        <br><br>
        
        <!-- Organization selection for sponsors -->
        <div id="organization-section" style="display: none;">
            <label for="organization_id">Organization (Optional):</label>
            <select id="organization_id" name="organization_id">
                <option value="">-- Create New Temp Organization --</option>
                {% for org in organizations %}
                    <option value="{{ org.ORG_ID }}">{{ org.ORG_NAME }}</option>
                {% endfor %}
            </select>
            <br><br>
            <small class="text-muted">Select an existing approved organization or leave blank to create a temporary organization.</small>
            <br><br>
        </div>
        
        <button type="submit" class="btn">Create User</button>
        
        <script>
            // Show/hide organization section based on role selection
            document.getElementById('role').addEventListener('change', function() {
                const orgSection = document.getElementById('organization-section');
                if (this.value === 'sponsor') {
                    orgSection.style.display = 'block';
                } else {
                    orgSection.style.display = 'none';
                }
            });
        </script>
    </form>
    <p><a href="{{ url_for('administrator_bp.dashboard') }}" class="btn btn-outline">Back to Dashboard</a></p>
{% endblock %}