{% extends "base.html" %}
{% block content %}
  <div class="page-header">
    <h1>Global Dropped Drivers Report</h1>
    <p class="text-muted" style="margin:0;">Audit history of all drivers dropped across all organizations.</p>
  </div>

  {% if rows|length == 0 %}
    <div class="empty-state">
      <div class="empty-state-icon">
        <svg xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
      </div>
      <p class="empty-state-heading">No drivers have been dropped from any organization yet.</p>
      <!-- Assuming an admin reports menu endpoint exists -->
      <a href="{{ url_for('administrator_bp.dashboard') }}" class="btn btn-primary">Back to Admin Dashboard</a>
    </div>
  {% else %}
    <div class="card-elevated">
      <div class="card-header-accent">
        <h2>Global Audit Trail ({{ rows|length }} Entries)</h2>
      </div>
      <div class="org-card-body">
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Time (UTC)</th>
                <th>Organization ID</th> 
                <th>Driver</th>
                <th>Sponsor (Actioning User)</th>
                <th>Raw Details</th>
              </tr>
            </thead>
            <tbody>
              {% for r in rows %}
                <tr>
                  <td>{{ r.log.CREATED_AT.strftime('%Y-%m-%d %H:%M:%S') if r.log.CREATED_AT else '' }}</td>
                  <td>
                    <span class="badge-primary">{{ r.org_id }}</span>
                  </td>
                  <td>
                    {% if r.driver %}
                      {{ r.driver.USERNAME }} ({{ r.driver.FNAME }} {{ r.driver.LNAME }})
                    {% else %}
                      Unknown (id in log)
                    {% endif %}
                  </td>
                  <td>
                    {% if r.sponsor %}
                      {{ r.sponsor.USERNAME }}
                    {% else %}
                      Unknown
                    {% endif %}
                  </td>
                  <td><code>{{ r.log.DETAILS or "" }}</code></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% endif %}

  <div class="card-elevated" style="margin-top:1.5rem;">
    <div class="card-header-accent">
      <h2>Navigation</h2>
    </div>
    <div class="org-card-body" style="text-align:center;">
      <!-- Assuming an admin reports menu endpoint exists -->
      <a href="{{ url_for('administrator_bp.dashboard') }}" class="btn btn-outline">‚Üê Back to Admin Dashboard</a>
    </div>
  </div>
{% endblock %}