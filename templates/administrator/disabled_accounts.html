{% extends "base.html" %}

{% block title %}Inactive Users - TTT Rewards{% endblock %}

{% block styles %}
  {{ super() }} {# Ensure theme.css + style.css are included #}
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />
{% endblock %}

{% block content %}
  <div class="page-header">
    <h1>Inactive Users</h1>
  </div>

  <div class="card-elevated">
    <div class="org-card-body">
      <a href="{{ url_for('administrator_bp.dashboard') }}" class="btn-dash" aria-label="Back to Administrator Dashboard" style="margin-bottom:1rem; display:inline-flex;">
        ‚Üê Back
      </a>

      <form id="filter-form" method="GET" action="{{ url_for('administrator_bp.disabled_accounts') }}" style="display:flex; flex-direction:column; gap:1rem; margin-bottom:1.5rem;">
        <div style="display:flex; align-items:center; gap:.5rem;">
          <input type="text" name="search" placeholder="Search by username..." value="{{ request.args.get('search', '') }}" aria-label="Search by username" class="input" style="flex:1;">
          <button type="submit" class="btn-outline btn">Search</button>
          <button id="filter-toggle" type="button" class="btn-outline btn" style="width:40px; height:40px; display:flex; align-items:center; justify-content:center;" title="Filter by role" aria-label="Filter by role">
            <i class="fa fa-filter"></i>
          </button>
        </div>

        <div id="role-filter" style="display:none; flex-wrap:wrap; gap:.5rem; background: var(--surface); padding:1rem; border-radius:8px; border:1px solid var(--border);">
          <select name="role" class="input">
            <option value="">All Roles</option>
            <option value="admin" {% if request.args.get('role') == 'admin' %}selected{% endif %}>Admin</option>
            <option value="sponsor" {% if request.args.get('role') == 'sponsor' %}selected{% endif %}>Sponsor</option>
            <option value="driver" {% if request.args.get('role') == 'driver' %}selected{% endif %}>Driver</option>
          </select>
          <button type="submit" class="btn-outline btn">Apply</button>
          <a href="{{ url_for('administrator_bp.disabled_accounts') }}" class="btn-outline btn">Reset</a>
        </div>
      </form>

      <script>
        document.addEventListener('DOMContentLoaded', function() {
          const toggle = document.getElementById('filter-toggle');
          const roleSection = document.getElementById('role-filter');
          toggle.addEventListener('click', () => {
            roleSection.style.display = roleSection.style.display === 'none' ? 'flex' : 'none';
          });
        });
      </script>

      {% if accounts %}
        <div class="table-wrapper">
        <table aria-describedby="inactive-users-caption">
          <caption id="inactive-users-caption" class="text-muted" style="text-align:left; padding:.5rem 0;">
            List of currently inactive users
          </caption>
          <thead>
            <tr>
              <th scope="col">Username</th>
              <th scope="col">Name</th>
              <th scope="col">Email</th>
              <th scope="col">Type</th>
              <th scope="col">Joined</th>
              <th scope="col" style="width: 140px;">Actions</th>
            </tr>
          </thead>
          <tbody>
          {% for user in accounts %}
            <tr>
              <td><strong>{{ user.USERNAME }}</strong></td>
              <td>{{ user.FNAME }} {{ user.LNAME }}</td>
              <td>{{ user.EMAIL }}</td>
              <td><span class="badge-outline-small">{{ user.USER_TYPE }}</span></td>
              <td>{{ user.CREATED_AT.strftime('%Y-%m-%d %H:%M') }}</td>
              <td class="actions-cell">
                {% if user.USER_CODE != current_user.USER_CODE %}
                <div class="table-action-column">
                  <form
                    method="POST"
                    action="{{ url_for('administrator_bp.enable_user', user_id=user.USER_CODE) }}"
                    onsubmit="return confirm('Are you sure you want to ENABLE {{ user.USERNAME }}? This will set the account to active.');"
                  >
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button
                      type="submit"
                      class="table-btn table-btn-accent"
                      aria-label="Enable user {{ user.USERNAME }}"
                    >
                      Enable
                    </button>
                  </form>
                </div>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
        </div>
      {% else %}
        <div class="box" role="status">
          <p class="text-muted" style="margin:0;">No deactivated users found.</p>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
{% endblock %}
