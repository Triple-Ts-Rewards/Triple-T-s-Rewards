{% extends "base.html" %}
{% block content %}
    <h2>Sponsor Dashboard</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-messages {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="box" style="margin-bottom: 2rem; max-width: 600px;">
        <h3>Award Points to Drivers</h3>
        {% if drivers %}
            <table style="width: 100%;">
                <thead>
                    <tr>
                        <th>Driver Username</th>
                        <th>Current Points</th>
                        <th style="width: 200px;">Add Points</th>
                    </tr>
                </thead>
                <tbody>
                    {% for driver in drivers %}
                    <tr>
                        <td>{{ driver.USERNAME }}</td>
                        <td>{{ driver.POINTS }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('sponsor_bp.award_points', driver_id=driver.USER_CODE) }}" style="display: flex; gap: 0.5rem;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <input type="number" name="points" min="1" placeholder="Points" style="width: 100px;" required>
                                <button type="submit" style="width: auto; padding: 0.4rem 0.8rem;">Award</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No drivers found.</p>
        {% endif %}
    </div>

    <div class="box" style="margin-bottom: 2rem;">
        <h3>Driver Management</h3>
        <a href="{{ url_for('sponsor_bp.add_user') }}">Add a New Driver</a>
    </div>

    <div class="box" style="margin-bottom: 2rem;">
        <h3>Pending Driver Applications</h3>
        <p>View and review applications submitted by drivers.</p>
        <a href="{{ url_for('sponsor_bp.review_driver_applications') }}">Review Driver Applications</a>
    </div>
    
    <div class="box">
        <h3>Current Store Settings</h3>
        <p><strong>eBay Category ID:</strong> {{ settings.ebay_category_id }}</p>
        <p><strong>Points per Dollar:</strong> {{ settings.point_ratio }}</p>
    </div>

    <form method="POST" action="{{ url_for('sponsor_bp.update_settings') }}" style="margin-top: 2rem;">
        <h3>Update Store Settings</h3>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <label for="ebay_category_id">eBay Category ID:</label>
        <input type="text" id="ebay_category_id" name="ebay_category_id" value="{{ settings.ebay_category_id }}" required>
        <label for="point_ratio">Points per Dollar:</label>
        <input type="number" id="point_ratio" name="point_ratio" value="{{ settings.point_ratio }}" required>
        <button type="submit">Save Changes</button>
    </form>

    <a href="{{ url_for('auth.logout') }}">Logout</a>
    <p><a href="/">Back</a></p>
{% endblock %}