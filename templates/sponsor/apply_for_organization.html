{% extends "base.html" %}

{% block content %}

  <div class="page-header">
      <h1>Organization Approval Application</h1>
      <p class="text-muted" style="margin: 0;">Submit or update the organization name that appears to drivers.</p>
  </div>

  <div class="card-elevated">
      <div class="card-header-accent">
          <h2>Status & Details</h2>
      </div>

      <div class="org-card-body">

            {% if sponsor and sponsor.organization %}
                <p style="text-align: center; margin-bottom: 1rem;">
                    Current status:
                    <span class="badge-outline-small" style="margin-left: 0.5rem;">
                        {{ sponsor.organization.STATUS }}
                    </span>
                </p>
                
                {% if sponsor.organization.STATUS == 'Approved' %}
                    <div class="flash-messages success" style="text-align:center;">
                        Your organization "{{ sponsor.organization.ORG_NAME }}" is approved. Use this form to update the name if needed.
                    </div>
                {% elif sponsor.organization.STATUS == 'Pending' %}
                    <div class="flash-messages info" style="text-align:center;">
                        Your application for "{{ sponsor.organization.ORG_NAME }}" is pending review. Thank you for your patience.
                    </div>
                {% elif sponsor.organization.STATUS == 'Rejected' %}
                    <div class="flash-messages danger" style="text-align:center;">
                        Your previous application for "{{ sponsor.organization.ORG_NAME }}" was rejected. Please submit a new name below.
                    </div>
                {% endif %}

            {% endif %}

            <div style="margin-top: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid #eee;">
                <h3>Join an Existing Organization</h3>
                <form method="POST" action="{{ url_for('sponsor_bp.apply_for_organization') }}" class="form-inline" style="display:flex; gap:1rem; align-items:flex-end;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <div class="form-group" style="flex-grow:1;">
                        <label for="existing_org_select">Select Organization</label>
                        <select id="existing_org_select" name="org_name" class="form-control" style="width:100%;">
                            <option value="" disabled selected>-- Choose an Organization --</option>
                            {% for org in available_orgs %}
                                <option value="{{ org.ORG_NAME }}">{{ org.ORG_NAME }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success">Join Selected</button>
                </form>
            </div>
            <div style="margin-top: 1.5rem;">
                <h3>Create or Update Organization</h3>
                <form method="POST" action="{{ url_for('sponsor_bp.apply_for_organization') }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                    <div class="form-group">
                        <label for="org_name">Organization Name</label>
                        <input type="text" 
                               id="org_name" 
                               name="org_name" 
                               value="{{ sponsor.organization.ORG_NAME if sponsor and sponsor.organization else '' }}" 
                               required 
                               placeholder="e.g., Triple-T Trucking Rewards">
                        <small class="text-muted">Drivers will see this name when applying for sponsorship.</small>
                    </div>

                    <div class="form-actions" style="margin-top: 1.5rem;">
                        <button type="submit" class="btn btn-primary">Submit for Approval / Update Details</button>
                    </div>
                </form>
            </div>
      </div>
  </div>

  <div class="card-elevated">
      <div class="card-header-accent">
          <h2>Navigation</h2>
      </div>
      <div class="org-card-body" style="text-align:center;">
          <a class="btn btn-outline" href="{{ url_for('sponsor_bp.dashboard') }}">‚Üê Back to Sponsor Dashboard</a>
      </div>
  </div>
{% endblock %}
