{% extends "base.html" %}

{% block title %}Driver Dashboard{% endblock %}

{% block content %}

  <!-- Card: Total Points -->
  <div class="card-elevated">
      <div class="card-header-accent">
          <h2>Welcome, {{ current_user.USERNAME }}</h2>
      </div>
      <div class="org-card-body">
          <h3>Your Total Points Balance</h3>
          <p style="font-size: 2.2rem; font-weight: 700; margin: 0;">
            {{ total_points if total_points is defined else 'N/A' }}
          </p>
          <p class="text-muted" style="margin-top: 0.5rem;">Sum of points from all sponsor organizations.</p>
      </div>
  </div>

  <!-- Card: Sponsor Stores -->
  <div class="card-elevated">
      <div class="card-header-accent">
          <h2>Your Sponsor Stores</h2>
      </div>
      <div class="org-card-body">
          {% if associations %}
              <p>Choose a sponsor to view rewards and balance.</p>
              <ul class="list-group" style="padding-left: 0; margin-top: 1rem;">
                  {% for assoc in associations %}
                      <li class="list-group-item"
                          style="display: flex; justify-content: space-between; align-items: center; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; margin-bottom: 0.75rem; padding: 0.75rem 1rem;">
                          
                          <a href="{{ url_for('driver_bp.truck_rewards_store', org_id=assoc.ORG_ID) }}"
                             style="font-weight: 600; color: var(--link-color);">
                              {{ assoc.organization.ORG_NAME }}
                          </a>

                          <span class="badge-accent badge-small">
                              {{ assoc.points }} points
                          </span>
                      </li>
                  {% endfor %}
              </ul>
          {% else %}
              <p class="text-muted">You are not linked to any sponsor organizations.</p>
          {% endif %}
      </div>
  </div>

  <!-- Card: Quick Actions -->
  <div class="card-elevated">
      <div class="card-header-accent">
          <h2>Quick Actions</h2>
      </div>
      <div class="org-card-body">

          <div class="dashboard-actions">
              <a href="{{ url_for('driver_bp.point_history') }}" class="btn-dash">
                  View Point History
              </a>

              <a href="{{ url_for('driver_bp.addresses') }}" class="btn-dash">
                  Manage Shipping Addresses
              </a>

              <a href="{{ url_for('driver_bp.sponsor_info_select') }}" class="btn-dash">
                  Sponsor Information
              </a>

              <a href="{{ url_for('driver_bp.apply_driver') }}" class="btn-dash">
                  Apply to a New Sponsor
              </a>

              <a href="{{ url_for('driver_bp.request_points') }}" class="btn-dash">
                  Request Point Change    
              </a>

              <a href="{{ url_for('driver_bp.update_contact') }}" class="btn-dash">
                  Edit Account Information
              </a>

              <a href="{{ url_for('auth.settings') }}" class="btn-dash">
                  My Settings
              </a>
          </div>

      </div>
  </div>
</div>
{% endblock %}