{% extends "base.html" %}

{% block content %}

  <div class="page-header">
      <h1>Apply to a Sponsor</h1>
      <p class="text-muted" style="margin: 0;">Tell us which organization you want to join and why.</p>
  </div>

  <div class="card-elevated">
      <div class="card-header-accent">
          <h2>Application Form</h2>
      </div>

      <div class="org-card-body">
    <form method="POST" action="{{ url_for('driver_bp.apply_driver') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <div class="form-group">
        <label for="org_id">Choose an Organization:</label>
        <select name="org_id" id="org_id" required>
          {% for org in organizations %}
            <option value="{{ org.ORG_ID }}">{{ org.ORG_NAME }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group" style="margin-top: 1rem;">
        <label for="reason">Why do you want to join this organization?</label>
        <textarea name="reason" id="reason" rows="4" placeholder="Write your reason here..."></textarea>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Submit Application</button>
        <a href="{{ url_for('driver_bp.dashboard') }}" class="btn btn-outline">Cancel</a>
      </div>
    </form>
      </div>
  </div>

  {% if my_applications %}
  <div class="card-elevated mt-4">
      <div class="card-header-accent">
          <h2>Your Applications</h2>
      </div>
      <div class="org-card-body">
          <div class="table-responsive">
              <table class="table table-striped">
                  <thead>
                      <tr>
                          <th>Organization</th>
                          <th>Status</th>
                          <th>Reason</th>
                          <th>Date Applied</th>
                      </tr>
                  </thead>
                  <tbody>
                      {% for app in my_applications %}
                      <tr>
                          <td>{{ app.organization.ORG_NAME }}</td>
                          <td>
                              {% if app.STATUS == 'Pending' %}
                                  <span class="badge bg-warning text-dark">{{ app.STATUS }}</span>
                              {% elif app.STATUS == 'Accepted' %}
                                  <span class="badge bg-success">{{ app.STATUS }}</span>
                              {% elif app.STATUS == 'Rejected' %}
                                  <span class="badge bg-danger">{{ app.STATUS }}</span>
                              {% else %}
                                  <span class="badge bg-secondary">{{ app.STATUS }}</span>
                              {% endif %}
                          </td>
                          <td>{{ app.REASON or 'No reason provided' }}</td>
                          <td>{{ app.APPLIED_AT.strftime('%Y-%m-%d') }}</td>
                      </tr>
                      {% endfor %}
                  </tbody>
              </table>
          </div>
      </div>
  </div>
  {% endif %}

{% endblock %}
